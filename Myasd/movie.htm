<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Movie Details - MyMovs</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <!-- Header Section -->
    <header>
        <div class="container">
            <div class="logo">
                <h1><a href="index.html">MyMovs</a></h1>
            </div>
            <nav>
                <ul>
                    <li><a href="index.html">Home</a></li>
                    <li><a href="#">Movies</a></li>
                    <li><a href="#">TV Shows</a></li>
                    <li><a href="#">Top Rated</a></li>
                </ul>
            </nav>
            <div class="search-box">
                <input type="text" id="search" placeholder="Search for movies...">
                <button id="search-btn"><i class="fas fa-search"></i></button>
            </div>
            <div class="mobile-menu">
                <i class="fas fa-bars"></i>
            </div>
        </div>
    </header>

    <!-- Movie Details Section -->
    <section class="movie-details-page">
        <div id="movie-backdrop" class="movie-backdrop"></div>
        <div class="container">
            <div id="movie-content" class="movie-content">
                <!-- Movie details will be loaded here by JavaScript -->
                <div class="loading">
                    <div class="spinner"></div>
                </div>
            </div>
        </div>
    </section>

    <!-- Similar Movies Section -->
    <section class="movie-section">
        <div class="container">
            <h3>Similar Movies</h3>
            <div class="movie-slider" id="similar-movies">
                <!-- Movies will be loaded here by JavaScript -->
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer>
        <div class="container">
            <div class="footer-content">
                <div class="footer-logo">
                    <h2>MyMovs</h2>
                    <p>The best movie streaming experience.</p>
                </div>
                <div class="footer-links">
                    <h4>Links</h4>
                    <ul>
                        <li><a href="index.html">Home</a></li>
                        <li><a href="#">Movies</a></li>
                        <li><a href="#">TV Shows</a></li>
                        <li><a href="#">Contact Us</a></li>
                    </ul>
                </div>
                <div class="footer-social">
                    <h4>Follow Us</h4>
                    <div class="social-icons">
                        <a href="#"><i class="fab fa-facebook-f"></i></a>
                        <a href="#"><i class="fab fa-twitter"></i></a>
                        <a href="#"><i class="fab fa-instagram"></i></a>
                    </div>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2025 MyMovs. All Rights Reserved.</p>
            </div>
        </div>
    </footer>

    <script>
        // API Configuration
        const API_KEY = '04c35731a5ee918f014970082a0088b1';
        const TMDB_BASE_URL = 'https://api.themoviedb.org/3';
        const IMG_BASE_URL = 'https://image.tmdb.org/t/p/w500';
        const BACKDROP_BASE_URL = 'https://image.tmdb.org/t/p/original';
        
        // DOM Elements
        const movieContent = document.getElementById('movie-content');
        const movieBackdrop = document.getElementById('movie-backdrop');
        const similarMoviesEl = document.getElementById('similar-movies');
        const searchBtn = document.getElementById('search-btn');
        const searchInput = document.getElementById('search');
        const mobileMenu = document.querySelector('.mobile-menu');
        
        // Get movie ID from URL
        const urlParams = new URLSearchParams(window.location.search);
        const movieId = urlParams.get('id');
        
        // Event Listeners
        document.addEventListener('DOMContentLoaded', () => {
            if (movieId) {
                loadMovieDetails(movieId);
                loadSimilarMovies(movieId);
            } else {
                window.location.href = 'index.html';
            }
        });
        
        searchBtn.addEventListener('click', () => {
            const query = searchInput.value.trim();
            if (query) {
                window.location.href = `index.html?search=${encodeURIComponent(query)}`;
            }
        });
        
        mobileMenu.addEventListener('click', toggleMobileMenu);
        
        // Load Movie Details
        async function loadMovieDetails(id) {
            try {
                const movie = await fetchMovieDetails(id);
                renderMovieDetails(movie);
            } catch (error) {
                console.error('Error loading movie details:', error);
                movieContent.innerHTML = `
                    <div class="error-message">
                        <h2>Error loading movie details</h2>
                        <p>Please try again later or go back to <a href="index.html">home</a>.</p>
                    </div>
                `;
            }
        }
        
        // Fetch Movie Details
        async function fetchMovieDetails(movieId) {
            const response = await fetch(`${TMDB_BASE_URL}/movie/${movieId}?api_key=${API_KEY}&append_to_response=videos,credits`);
            if (!response.ok) {
                throw new Error('Failed to fetch movie details');
            }
            return await response.json();
        }
        
        // Render Movie Details
        function renderMovieDetails(movie) {
            // Set backdrop
            movieBackdrop.style.backgroundImage = `linear-gradient(rgba(15, 16, 22, 0.7), rgba(15, 16, 22, 1)), url('${BACKDROP_BASE_URL}${movie.backdrop_path}')`;
            
            // Get director
            const director = movie.credits?.crew.find(person => person.job === 'Director')?.name || 'N/A';
            
            // Get cast
            const cast = movie.credits?.cast.slice(0, 5).map(actor => actor.name).join(', ') || 'N/A';
            
            // Get trailer
            const trailer = movie.videos?.results.find(video => video.type === 'Trailer') || null;
            
            // Update page title
            document.title = `${movie.title} - MyMovs`;
            
            // Render movie details
            movieContent.innerHTML = `
                <div class="movie-detail-page">
                    <div class="movie-poster">
                        <img src="${IMG_BASE_URL}${movie.poster_path}" alt="${movie.title}">
                    </div>
                    <div class="movie-info-page">
                        <h1>${movie.title}</h1>
                        <div class="movie-meta-page">
                            <span><i class="fas fa-calendar"></i> ${movie.release_date.split('-')[0]}</span>
                            <span><i class="fas fa-clock"></i> ${movie.runtime} min</span>
                            <span><i class="fas fa-star"></i> ${movie.vote_average.toFixed(1)}</span>
                        </div>
                        <div class="genres">
                            ${movie.genres.map(genre => `<span>${genre.name}</span>`).join('')}
                        </div>
                        <div class="overview-page">
                            <h3>Overview</h3>
                            <p>${movie.overview}</p>
                        </div>
                        <div class="movie-details-info">
                            <p><strong>Director:</strong> ${director}</p>
                            <p><strong>Cast:</strong> ${cast}</p>
                        </div>
                        <div class="movie-actions">
                            <button class="btn-watch" onclick="watchMovie(${movie.id}, '${movie.title.replace(/'/g, "\\'")}')">
                                <i class="fas fa-play"></i> Watch Now
                            </button>
                            ${trailer ? `
                            <button class="btn-trailer" onclick="watchTrailer('${trailer.key}')">
                                <i class="fas fa-film"></i> Watch Trailer
                            </button>` : ''}
                        </div>
                    </div>
                </div>
            `;
        }
        
        // Load Similar Movies
        async function loadSimilarMovies(id) {
            try {
                const response = await fetch(`${TMDB_BASE_URL}/movie/${id}/similar?api_key=${API_KEY}`);
                if (!response.ok) {
                    throw new Error('Failed to fetch similar movies');
                }
                
                const data = await response.json();
                renderSimilarMovies(data.results);
            } catch (error) {
                console.error('Error loading similar movies:', error);
                similarMoviesEl.innerHTML = '<p>Failed to load similar movies.</p>';
            }
        }
        
        // Render Similar Movies
        function renderSimilarMovies(movies) {
            similarMoviesEl.innerHTML = '';
            
            movies.forEach(movie => {
                if (!movie.poster_path) return;
                
                const movieCard = document.createElement('div');
                movieCard.classList.add('movie-card');
                movieCard.innerHTML = `
                    <img src="${IMG_BASE_URL}${movie.poster_path}" alt="${movie.title}">
                    <div class="movie-info">
                        <h4>${movie.title}</h4>
                        <div class="rating">
                            <i class="fas fa-star"></i>
                            <span>${movie.vote_average.toFixed(1)}</span>
                        </div>
                    </div>
                    <div class="play-overlay">
                        <i class="fas fa-play"></i>
                    </div>
                `;
                
                movieCard.addEventListener('click', () => {
                    window.location.href = `movie.html?id=${movie.id}`;
                });
                
                similarMoviesEl.appendChild(movieCard);
            });
        }
        
        // Watch Movie Function
        function watchMovie(movieId, movieTitle) {
            // Same implementation as in script.js
            const playerHTML = `
                <!DOCTYPE html>
                <html lang="en">
                <head>
                    <meta charset="UTF-8">
                    <meta name="viewport" content="width=device-width, initial-scale=1.0">
                    <title>Watch ${movieTitle} - MyMovs</title>
                    <link rel="stylesheet" href="styles.css">
                    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
                </head>
                <body>
                    <!-- Header Section -->
                    <header>
                        <div class="container">
                            <div class="logo">
                                <h1><a href="index.html">MyMovs</a></h1>
                            </div>
                            <nav>
                                <ul>
                                    <li><a href="index.html">Home</a></li>
                                    <li><a href="#">Movies</a></li>
                                    <li><a href="#">TV Shows</a></li>
                                    <li><a href="#">Top Rated</a></li>
                                </ul>
                            </nav>
                            <div class="mobile-menu">
                                <i class="fas fa-bars"></i>
                            </div>
                        </div>
                    </header>

                    <!-- Player Section -->
                    <div class="player-container">
                        <div class="video-container">
                            <div id="loading" class="loading">
                                <div class="spinner"></div>
                            </div>
                            <video id="video-player" class="video-player" controls autoplay>
                                <source src="#" type="video/mp4">
                                Your browser does not support the video tag.
                            </video>
                        </div>
                        <div class="player-controls">
                            <div class="player-info">
                                <h3>${movieTitle}</h3>
                            </div>
                            <div class="player-buttons">
                                <button id="back-btn" onclick="window.history.back()">
                                    <i class="fas fa-arrow-left"></i> Back
                                </button>
                            </div>
                        </div>
                    </div>

                    <script>
                        // Simulate video loading
                        setTimeout(() => {
                            document.getElementById('loading').style.display = 'none';
                            const player = document.getElementById('video-player');
                            player.pause();
                            
                            // Alert user about demo functionality
                            alert("This is a demo. In a real application, this would play the actual movie from your content server.");
                            
                            // Show sample video
                            player.innerHTML = '<div style="display: flex; align-items: center; justify-content: center; height: 100%; background: #000; color: #fff; font-size: 24px; text-align: center; padding: 20px;">Demo: This would be the ${movieTitle} video player</div>';
                        }, 3000);
                    </script>
                </body>
                </html>
            `;
            
            const playerWindow = window.open('', '_blank');
            playerWindow.document.write(playerHTML);
            playerWindow.document.close();
        }
        
        // Watch Trailer Function
        function watchTrailer(videoKey) {
            const trailerUrl = `https://www.youtube.com/embed/${videoKey}?autoplay=1`;
            window.open(trailerUrl, '_blank');
        }
        
        // Toggle Mobile Menu
        function toggleMobileMenu() {
            const nav = document.querySelector('nav');
            nav.style.display = nav.style.display === 'block' ? 'none' : 'block';
        }
    </script>
</body>
</html>
